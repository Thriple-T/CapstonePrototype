<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ student.first_name }} {{ student.last_name }} Details</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        .detail-card { 
            border: 1px solid #ccc; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 20px;
            max-width: 800px;
        }
        .section-header { margin-top: 30px; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        th { background-color: #f4f4f4; }
        .status-active { color: green; font-weight: bold; }
        .balance-owed { color: #dc3545; font-weight: bold; }
        .balance-credit { color: green; }
    </style>
</head>
<body>
    <p><a href="{% url 'fetch_data' %}">‚Üê Back to Dashboard</a></p>

    <h1>Student Profile: {{ student.first_name }} {{ student.last_name }}</h1>

    <div class="detail-card">
        <h2>General Information</h2>
        <p><strong>Student ID:</strong> {{ student.student_id }}</p>
        <p><strong>Email:</strong> {{ student.email|default:"N/A" }}</p>
        <p><strong>Enrollment Date:</strong> {{ student.date_added|date:"F j, Y" }}</p>
        <p><strong>Current Status:</strong> 
            {% if student.status == 'ACT' %}
                <span class="status-active">Active</span>
            {% else %}
                <span>{{ student.get_status_display }}</span>
            {% endif %}
        </p>
        <p>
            <a href="{% url 'edit_student' student.pk %}">Edit Student</a> | 
            <a href="{% url 'delete_student' student.pk %}" style="color: #dc3545;">Delete Student</a>
        </p>
    </div>

    <div class="detail-card">
        <h2>Financial Status</h2>
        {% if student.current_balance > 0 %}
            <p><strong>Fees Owed:</strong> <span class="balance-owed">${{ student.current_balance|floatformat:2 }}</span></p>
        {% elif student.current_balance < 0 %}
            <p><strong>Account Credit:</strong> <span class="balance-credit">${{ student.absolute_balance|floatformat:2 }}</span></p>
        {% else %}
            <p><strong>Fees Owed:</strong> $0.00</p>
        {% endif %}
        
        <p>
            <a href="{% url 'add_payment' student.pk %}">Record a Payment</a>
        </p>
    </div>

    <h2 class="section-header">Course Enrollment History</h2>
    {% if enrollment_history %}
        <table style="width: 100%; border-collapse: collapse;">
            <thead style="background-color: #f4f4f4;">
                <tr>
                    <th>Course</th>
                    <th>Schedule (Snapshot)</th>
                    <th>Timeline</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for enrollment in enrollment_history %}
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 10px;">
                            <strong>{{ enrollment.course.name }}</strong><br>
                            <small style="color:gray">{{ enrollment.course.course_code }}</small>
                        </td>

                        <td style="padding: 10px;">
                            {{ enrollment.schedule_snapshot|default:"No schedule recorded" }}
                        </td>
                        
                        <td style="padding: 10px;">
                            {{ enrollment.start_date|date:"M j, Y" }} 
                            Example
                            {% if enrollment.end_date %}
                                to {{ enrollment.end_date|date:"M j, Y" }}
                            {% else %}
                                to <em>Present</em>
                            {% endif %}
                        </td>

                        <td style="padding: 10px;">
                            {% if enrollment.is_active %}
                                <span style="color: green; font-weight: bold;">In Progress</span>
                            {% else %}
                                <span style="color: gray;">Completed</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No enrollment history found.</p>
    {% endif %}

    <h2 class="section-header">Payment History</h2>
    {% if payments %}
        <table>
            <thead>
                <tr><th>Amount</th><th>Date</th><th>Notes</th></tr>
            </thead>
            <tbody>
                {% for payment in payments %}
                    <tr>
                        <td>${{ payment.amount|floatformat:2 }}</td>
                        <td>{{ payment.payment_date|date:"M j, Y" }}</td>
                        <td>{{ payment.notes|default:"-" }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No payment history found for this student.</p>
    {% endif %}

</body>
</html>